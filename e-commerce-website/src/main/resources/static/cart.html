<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart - E-Commerce Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome@6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-bg: #f8f9fa;
            --success-color: #28a745;
        }
        
        body {
            background-color: #f5f7f9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--primary-color) !important;
        }
        
        .cart-item {
            transition: all 0.3s;
            border-radius: 10px;
            background: white;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        .cart-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .cart-image {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #eee;
    background-color: #f8f9fa; /* Add a light background for placeholder */
}
        
        .quantity-control {
            width: 40px;
            text-align: center;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        
        .quantity-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .price {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .original-price {
            text-decoration: line-through;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .discount-badge {
            background: linear-gradient(45deg, var(--accent-color), #c82333);
            color: white;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .empty-cart {
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        .summary-card {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: sticky;
            top: 20px;
        }
        
        .btn-update {
            background: linear-gradient(45deg, var(--secondary-color), #343a40);
            border: none;
            color: white;
            transition: all 0.3s;
        }
        
        .btn-update:hover {
            background: linear-gradient(45deg, #232a31, #1d2124);
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-checkout {
            background: linear-gradient(45deg, var(--success-color), #20c997);
            border: none;
            padding: 12px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-checkout:hover {
            background: linear-gradient(45deg, #218838, #1e9e7c);
            transform: translateY(-2px);
        }
        
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .toast {
            background: white;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .toast.success {
            border-left-color: var(--success-color);
        }
        
        .toast.error {
            border-left-color: var(--accent-color);
        }
        
        .summary-title {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--light-bg);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .promo-section {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="products.html">
                <i class="fas fa-store me-2"></i>E-Commerce Store
            </a>
            
            <div class="d-flex">
                <a href="products.html" class="btn btn-outline-light me-2">
                    <i class="fas fa-shopping-bag me-1"></i> Continue Shopping
                </a>
                <a href="cart.html" class="btn btn-outline-light position-relative me-2">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cartCount">0</span>
                </a>
                <button class="btn btn-outline-light" id="loginButton">
                    <i class="fas fa-user me-1"></i> Login
                </button>
                <button class="btn btn-outline-light ms-2 d-none" id="logoutButton">
                    <i class="fas fa-sign-out-alt me-1"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-4">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="products.html">Products</a></li>
                        <li class="breadcrumb-item active">Shopping Cart</li>
                    </ol>
                </nav>
                <h1 class="mb-4"><i class="fas fa-shopping-cart me-2"></i>Your Shopping Cart</h1>
            </div>
        </div>

        <!-- Loading State -->
        <div class="row" id="loadingState">
            <div class="col-12 text-center py-5">
                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 fs-5">Loading your cart...</p>
            </div>
        </div>

        <!-- Cart Content -->
        <div class="row d-none" id="cartContent">
            <div class="col-lg-8">
                <!-- Cart Items -->
                <div class="card mb-4 border-0">
                    <div class="card-body p-0">
                        <div id="cartItemsContainer">
                            <!-- Cart items will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Empty Cart State -->
                <div class="empty-cart d-none" id="emptyCart">
                    <div class="text-center p-5">
                        <i class="fas fa-shopping-cart fa-4x text-muted mb-4"></i>
                        <h3>Your cart is empty</h3>
                        <p class="text-muted mb-4">Looks like you haven't added anything to your cart yet.</p>
                        <a href="products.html" class="btn btn-primary btn-lg mt-3">
                            <i class="fas fa-shopping-bag me-2"></i> Start Shopping
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <!-- Order Summary -->
                <div class="card summary-card border-0">
                    <div class="card-body">
                        <h5 class="card-title mb-4 summary-title"><i class="fas fa-receipt me-2"></i>Order Summary</h5>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span id="subtotal">$0.00</span>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span>Shipping:</span>
                            <span id="shipping">$0.00</span>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span>Tax:</span>
                            <span id="tax">$0.00</span>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-2 text-success" id="discountRow">
                            <span>Discount:</span>
                            <span id="discount">-$0.00</span>
                        </div>
                        
                        <hr>
                        
                        <div class="d-flex justify-content-between mb-4 fs-5">
                            <strong>Total:</strong>
                            <strong id="total">$0.00</strong>
                        </div>
                        
                        <div class="promo-section">
                            <h6 class="mb-3"><i class="fas fa-tag me-2"></i>Promo Code</h6>
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Enter code">
                                <button class="btn btn-outline-primary">Apply</button>
                            </div>
                        </div>
                        
                        <button class="btn btn-checkout w-100 mb-3" id="checkoutBtn">
                            <i class="fas fa-lock me-2"></i>Proceed to Checkout
                        </button>
                        
                        <div class="text-center">
                            <small class="text-muted">
                                <i class="fas fa-shield-alt me-1"></i> Your payment information is secure
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div class="row d-none" id="errorState">
            <div class="col-12 text-center py-5">
                <i class="fas fa-exclamation-triangle fa-3x text-danger mb-4"></i>
                <h3>Error Loading Cart</h3>
                <p class="text-muted mb-4" id="errorMessage">There was a problem loading your cart.</p>
                <button class="btn btn-primary mt-2" onclick="loadCart()">Try Again</button>
            </div>
        </div>
    </div>

    <!-- Login Required Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-exclamation-circle me-2"></i>Login Required</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>You need to be logged in to view your cart.</p>
                    <p>Would you like to go to the login page?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="goToLogin">Go to Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // API Base URL
      // API Base URL
const API_BASE_URL = 'http://localhost:8080';

// DOM Elements
const loadingState = document.getElementById('loadingState');
const cartContent = document.getElementById('cartContent');
const errorState = document.getElementById('errorState');
const emptyCart = document.getElementById('emptyCart');
const cartItemsContainer = document.getElementById('cartItemsContainer');
const cartCount = document.getElementById('cartCount');
const subtotalElement = document.getElementById('subtotal');
const shippingElement = document.getElementById('shipping');
const taxElement = document.getElementById('tax');
const discountElement = document.getElementById('discount');
const discountRow = document.getElementById('discountRow');
const totalElement = document.getElementById('total');
const checkoutBtn = document.getElementById('checkoutBtn');
const loginButton = document.getElementById('loginButton');
const logoutButton = document.getElementById('logoutButton');
const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));

// State
let cartData = null;

// Event Listeners
document.addEventListener('DOMContentLoaded', initializePage);
checkoutBtn.addEventListener('click', proceedToCheckout);
document.getElementById('goToLogin').addEventListener('click', redirectToLogin);
loginButton.addEventListener('click', redirectToLogin);
logoutButton.addEventListener('click', handleLogout);

// Initialize the page
function initializePage() {
    checkAuthStatus();
    loadCart();
}

// Check if user is authenticated
function checkAuthStatus() {
    const token = getToken();
    if (token) {
        loginButton.classList.add('d-none');
        logoutButton.classList.remove('d-none');
    } else {
        loginButton.classList.remove('d-none');
        logoutButton.classList.add('d-none');
        showLoginRequired();
    }
}

// Get JWT token from localStorage
function getToken() {
    return localStorage.getItem('jwtToken');
}

// Load cart data
function loadCart() {
    const token = getToken();
    
    if (!token) {
        showLoginRequired();
        return;
    }
    
    // Show loading state
    loadingState.classList.remove('d-none');
    cartContent.classList.add('d-none');
    errorState.classList.add('d-none');
    
    axios.get(`${API_BASE_URL}/cart/view`, {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        console.log("Cart API Response:", response.data);
        cartData = response.data;
        displayCart(cartData);
    })
    .catch(error => {
        console.error('Error loading cart:', error);
        console.error('Error response:', error.response);
        
        if (error.response && error.response.status === 401) {
            localStorage.removeItem('jwtToken');
            checkAuthStatus();
            loginModal.show();
        } else if (error.response && error.response.status === 404) {
            // Cart might not exist yet
            displayCart([]);
        } else {
            showErrorState('Failed to load your cart. Please try again.');
        }
    });
}

// Display cart data
// Display cart data
function displayCart(cart) {
    loadingState.classList.add('d-none');
    cartContent.classList.remove('d-none');
    
    console.log("Cart data structure:", cart);
    
    // Handle different response structures
    let cartItems = [];
    let cartTotal = 0;
    
    if (Array.isArray(cart)) {
        // If the response is directly an array of cart items
        cartItems = cart;
    } else if (cart && cart.cartItems) {
        // If the response has a cartItems property
        cartItems = cart.cartItems;
        cartTotal = cart.total || 0;
    } else if (cart && Array.isArray(cart.items)) {
        // If the response has an items property
        cartItems = cart.items;
        cartTotal = cart.total || 0;
    }
    
    if (!cartItems || cartItems.length === 0) {
        emptyCart.classList.remove('d-none');
        cartItemsContainer.innerHTML = '';
        updateCartSummary(0, 0, 0, 0);
        updateCartCount(0);
        return;
    }
    
    emptyCart.classList.add('d-none');
    
    // Display cart items
    cartItemsContainer.innerHTML = '';
    cartItems.forEach(item => {
        const cartItemElement = createCartItemElement(item);
        cartItemsContainer.appendChild(cartItemElement);
    });
    
    // FIXED: Calculate subtotal using DISCOUNTED prices, not original prices
    const subtotal = cartTotal > 0 ? cartTotal : cartItems.reduce((sum, item) => {
        const quantity = item.quantity || item.productQuantity || 0;
        
        // Calculate discounted price for this item
        const price = item.price || item.productPrice || 0;
        const discountPercent = Math.round(item.discountPercent || 0);
        const hasDiscount = discountPercent > 0;
        const discountedPrice = hasDiscount ? 
            Math.round(price * (1 - discountPercent / 100) * 100) / 100 : 
            price;
        
        return sum + (discountedPrice * quantity);
    }, 0);
    
    const shipping = subtotal > 0 ? 5.99 : 0;
    const tax = Math.round(subtotal * 0.08 * 100) / 100; // 8% tax, rounded to 2 decimals
    const discount = 0;
    
    updateCartSummary(subtotal, shipping, tax, discount);
    updateCartCount(cartItems.reduce((sum, item) => sum + (item.quantity || item.productQuantity || 0), 0));
}

// Create cart item HTML element

function createCartItemElement(item) {
    const row = document.createElement('div');
    row.className = 'p-3 border-bottom cart-item';
    
    // Extract data with fallbacks for different structures
    const productId = item.productId || item.id || 0;
    const productName = item.productName || item.name || 'Unknown Product';
    const category = item.category || 'General';
    const price = item.price || item.productPrice || 0;
    const quantity = item.quantity || item.productQuantity || 0;
    
    // Get the image URL with better handling
    const imageUrl = getProductImageUrl(item);
    
    // FIXED: Round discount to integer
    const discountPercent = Math.round(item.discountPercent || 0);
    const hasDiscount = discountPercent > 0;
    
    // FIXED: Calculate discounted price with proper rounding
    const discountedPrice = hasDiscount ? 
        Math.round(price * (1 - discountPercent / 100) * 100) / 100 : 
        price;
    
    // FIXED: Calculate item total with proper rounding
    const itemTotal = Math.round(discountedPrice * quantity * 100) / 100;
    
    row.innerHTML = `
        <div class="row align-items-center">
            <div class="col-md-2">
                <img src="${imageUrl}" 
                     class="cart-image" alt="${productName}"
                     onerror="handleImageError(this)">
            </div>
            <div class="col-md-4">
                <h6 class="mb-1">${productName}</h6>
                <p class="text-muted mb-0 small">${category}</p>
                ${hasDiscount ? 
                    `<span class="discount-badge">${discountPercent}% OFF</span>` : ''
                }
            </div>
            <div class="col-md-2">
                ${hasDiscount ? 
                    `<div>
                        <span class="original-price">$${price.toFixed(2)}</span>
                        <span class="price">$${discountedPrice.toFixed(2)}</span>
                    </div>` :
                    `<span class="price">$${price.toFixed(2)}</span>`
                }
            </div>
            <div class="col-md-2">
                <div class="d-flex align-items-center">
                    <button class="btn btn-sm btn-outline-secondary quantity-btn quantity-decrease" data-product-id="${productId}">-</button>
                    <input type="number" class="form-control form-control-sm quantity-control mx-1" 
                           value="${quantity}" min="1" data-product-id="${productId}">
                    <button class="btn btn-sm btn-outline-secondary quantity-btn quantity-increase" data-product-id="${productId}">+</button>
                </div>
            </div>
            <div class="col-md-2 text-end">
                <span class="price">$${itemTotal.toFixed(2)}</span>
                <button class="btn btn-sm btn-link text-danger remove-item" data-product-id="${productId}">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `;
    
    // Add event listeners
    const decreaseBtn = row.querySelector('.quantity-decrease');
    const increaseBtn = row.querySelector('.quantity-increase');
    const quantityInput = row.querySelector('.quantity-control');
    const removeBtn = row.querySelector('.remove-item');
    
    decreaseBtn.addEventListener('click', () => updateQuantity(productId, parseInt(quantityInput.value) - 1));
    increaseBtn.addEventListener('click', () => updateQuantity(productId, parseInt(quantityInput.value) + 1));
    quantityInput.addEventListener('change', () => updateQuantity(productId, parseInt(quantityInput.value)));
    removeBtn.addEventListener('click', () => removeFromCart(productId));
    
    return row;
}

// Add this helper function to handle image URL extraction
function getProductImageUrl(item) {
    // Check all possible image sources in order of priority
    if (item.imageUrl) {
        // If it's already a URL, use it directly
        return item.imageUrl;
    } else if (item.image) {
        // If it's a byte array (array of numbers), convert to base64
        if (Array.isArray(item.image)) {
            // Convert byte array to base64
            const byteArray = new Uint8Array(item.image);
            let binary = '';
            for (let i = 0; i < byteArray.length; i++) {
                binary += String.fromCharCode(byteArray[i]);
            }
            return 'data:image/jpeg;base64,' + btoa(binary);
        }
        // If it's a base64 encoded image, check if it already has the data URI prefix
        else if (item.image.startsWith('data:image/')) {
            return item.image;
        } else {
            return `data:image/jpeg;base64,${item.image}`;
        }
    } else if (item.images && item.images.length > 0) {
        // If there's an array of images, use the first one
        if (Array.isArray(item.images[0])) {
            // Convert byte array to base64
            const byteArray = new Uint8Array(item.images[0]);
            let binary = '';
            for (let i = 0; i < byteArray.length; i++) {
                binary += String.fromCharCode(byteArray[i]);
            }
            return 'data:image/jpeg;base64,' + btoa(binary);
        }
        else if (typeof item.images[0] === 'string') {
            if (item.images[0].startsWith('http')) {
                return item.images[0];
            } else if (item.images[0].startsWith('data:image/')) {
                return item.images[0];
            } else {
                return `data:image/jpeg;base64,${item.images[0]}`;
            }
        }
    } else if (item.productImage) {
        // If it's a product image field
        if (Array.isArray(item.productImage)) {
            // Convert byte array to base64
            const byteArray = new Uint8Array(item.productImage);
            let binary = '';
            for (let i = 0; i < byteArray.length; i++) {
                binary += String.fromCharCode(byteArray[i]);
            }
            return 'data:image/jpeg;base64,' + btoa(binary);
        }
        else if (typeof item.productImage === 'string') {
            if (item.productImage.startsWith('http')) {
                return item.productImage;
            } else if (item.productImage.startsWith('data:image/')) {
                return item.productImage;
            } else {
                return `data:image/jpeg;base64,${item.productImage}`;
            }
        }
    }
    
    // Fallback to placeholder
    return 'https://via.placeholder.com/100x100?text=No+Image';
}

// Add this function to handle image errors
// Add this function to handle image errors
function handleImageError(img) {
    console.log("Image failed to load, using placeholder");
    img.src = 'https://via.placeholder.com/100x100?text=No+Image';
    img.onerror = null; // Prevent infinite loop
    
    // Also set a data attribute to track that we've already tried to fix this image
    img.setAttribute('data-fallback', 'true');
}
// Update cart summary
// Update cart summary
function updateCartSummary(subtotal, shipping, tax, discount) {
    // FIXED: Use toFixed(2) for proper decimal display
    subtotalElement.textContent = `$${subtotal.toFixed(2)}`;
    shippingElement.textContent = `$${shipping.toFixed(2)}`;
    taxElement.textContent = `$${tax.toFixed(2)}`;
    
    if (discount > 0) {
        discountElement.textContent = `-$${discount.toFixed(2)}`;
        discountRow.classList.remove('d-none');
    } else {
        discountRow.classList.add('d-none');
    }
    
    // FIXED: Calculate total with proper rounding
    const total = Math.round((subtotal + shipping + tax - discount) * 100) / 100;
    totalElement.textContent = `$${total.toFixed(2)}`;
}
// Update cart count badge
function updateCartCount(count) {
    cartCount.textContent = count;
    if (count === 0) {
        cartCount.classList.add('d-none');
    } else {
        cartCount.classList.remove('d-none');
    }
}

// Update item quantity
function updateQuantity(productId, newQuantity) {
    if (newQuantity < 1) {
        removeFromCart(productId);
        return;
    }
    
    const token = getToken();
    if (!token) {
        loginModal.show();
        return;
    }
    
    // Ensure productId is a valid number
    const numericProductId = Number(productId);
    if (isNaN(numericProductId)) {
        showToast('Error', 'Invalid product ID', 'error');
        return;
    }
    
    axios.put(`${API_BASE_URL}/cart/update?productId=${numericProductId}&quantity=${newQuantity}`, {}, {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (response.data === true || response.status === 200) {
            showToast('Success', 'Cart updated successfully', 'success');
            loadCart(); // Reload the cart to reflect changes
        } else {
            showToast('Error', 'Failed to update cart', 'error');
        }
    })
    .catch(error => {
        console.error('Error updating cart:', error);
        if (error.response && error.response.status === 401) {
            localStorage.removeItem('jwtToken');
            checkAuthStatus();
            loginModal.show();
        } else {
            showToast('Error', 'Failed to update cart', 'error');
        }
    });
}

// Remove item from cart
function removeFromCart(productId) {
    const token = getToken();
    if (!token) {
        loginModal.show();
        return;
    }
    
    // Ensure productId is a valid number
    const numericProductId = Number(productId);
    if (isNaN(numericProductId)) {
        showToast('Error', 'Invalid product ID', 'error');
        return;
    }
    
    axios.delete(`${API_BASE_URL}/cart/remove?productId=${numericProductId}`, {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => {
        if (response.data === true || response.status === 200) {
            showToast('Success', 'Product removed from cart', 'success');
            loadCart(); // Reload the cart to reflect changes
        } else {
            showToast('Error', 'Failed to remove product', 'error');
        }
    })
    .catch(error => {
        console.error('Error removing from cart:', error);
        if (error.response && error.response.status === 401) {
            localStorage.removeItem('jwtToken');
            checkAuthStatus();
            loginModal.show();
        } else {
            showToast('Error', 'Failed to remove product', 'error');
        }
    });
}

// Proceed to checkout
function proceedToCheckout() {
    if (!cartData || !cartData.cartItems || cartData.cartItems.length === 0) {
        showToast('Info', 'Your cart is empty', 'info');
        return;
    }
    
    showToast('Info', 'Checkout functionality would be implemented here', 'info');
    // In a real application, you would redirect to a checkout page
    // window.location.href = 'checkout.html';
}

// Show error state
function showErrorState(message) {
    loadingState.classList.add('d-none');
    cartContent.classList.add('d-none');
    errorState.classList.remove('d-none');
    document.getElementById('errorMessage').textContent = message;
}

// Show login required state
function showLoginRequired() {
    loadingState.classList.add('d-none');
    cartContent.classList.add('d-none');
    errorState.classList.remove('d-none');
    document.getElementById('errorMessage').textContent = 'Please login to view your cart';
    document.querySelector('#errorState button').classList.add('d-none');
}

// Show toast notification
function showToast(title, message, type = 'info') {
    // Create toast element
    const toastContainer = document.getElementById('toastContainer');
    const toastId = 'toast-' + Date.now();
    
    const toastHtml = `
        <div class="toast ${type}" id="${toastId}" role="alert">
            <div class="toast-header">
                <strong class="me-auto">${title}</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    
    // Show the toast
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
    
    // Remove toast after it's hidden
    toastElement.addEventListener('hidden.bs.toast', function() {
        toastElement.remove();
    });
}

// Redirect to login page
function redirectToLogin() {
    window.location.href = 'login.html';
}

// Handle logout
function handleLogout() {
    localStorage.removeItem('jwtToken');
    checkAuthStatus();
    showToast('Success', 'You have been logged out', 'success');
    loadCart(); // This will show the login required state
}
    </script>
</body>
</html>